export PATH=/home/cloudera/workspace/miRNA_predictor/mirDeep-P/miRDP1.3:$PATH



#### known mirna ####
cloudera [~/workspace/miRNA_predictor/mirDeep-P/Known_M]
$ cp ../miRDP1.3/* .
$ perl fetch_extended_precursors.pl TAIR9_genome.fa ath.gff >annotated_miRNA_extended.fa
$ mkdir bowtie-index
$ bowtie-build -f annotated_miRNA_extended.fa bowtie-index/annotated_miRNA_extended
$ bowtie -a -v 0 bowtie-index/annotated_miRNA_extended -f AtShoot.fa >AtShoot_extende.aln
$ perl convert_bowtie_to_blast.pl AtShoot_extended.aln AtShoot.fa annotated_miRNA_extended.fa  > AtShoot_extended.bst
$ perl excise_candidate.pl annotated_miRNA_extended.fa AtShoot_extended.bst 250 >precursors_250.fa
$ bowtie-build -f precursors_250.fa bowtie-index/precursors_250
$ cat precursors_250.fa|RNAfold --noPS >precursors_250_structure
$ bowtie -a -v 0 bowtie-index/precursors_250 -f AtShoot.fa >AtShoot_250.aln
$ perl convert_bowtie_to_blast.pl AtShoot_250.aln AtShoot.fa precursors_250.fa >AtShoot_250.bst
$ sort +3 -25 AtShoot_250.bst >AtShoot_250_signature
$ perl miRDP.pl AtShoot_250_signature precursors_250_structure >AtShoot_250_prediction

#### new mirna ####
$ bowtie-build -f TAIR9_genome.fa bowtie-index/TAIR9_genome
$ bowtie -a -v 0 bowtie-index/TAIR9_genome -f AtShoot.fa >AtShoot.aln
$ convert_bowtie_to_blast.pl AtShoot.aln AtShoot.fa TAIR9_genome.fa >AtShoot.bst
$ perl filter_alignments.pl AtShoot.bst -c 15 >AtShoot_filter15.bst
$ perl overlap.pl AtShoot_filter15.bst ncRNA_CDS.gff -b >id_overlap_ncRNA_CDS
$ perl alignedselected.pl AtShoot_filter15.bst -g id_overlap_ncRNA_CDS >AtShoot_filter15_ncRNA_CDS.bst
$ perl filter_alignments.pl AtShoot_filter15_ncRNA_CDS.bst -b AtShoot.fa > AtShoot_filtered.fa
$ perl excise_candidate.pl TAIR9_genome.fa  AtShoot_filter15_ncRNA_CDS.bst 250 >AtShoot_precursors.fa
$ cat AtShoot_precursors.fa | RNAfold --noPS > AtShoot_structures
$ bowtie-build -f AtShoot_precursors.fa bowtie-index/ AtShoot_precursors
$ bowtie -a -v 0 bowtie-index/ AtShoot_precursors -f AtShoot_filtered.fa > AtShoot_precursors.aln
$ perl convert_bowtie_to_blast.pl AtShoot_precursors.aln AtShoot_filtered.fa AtShoot_precursors.fa >AtShoot_precursors.bst
$ sort +3 -25 AtShoot_precursors.bst >AtShoot_signatures
$ perl miRDeep.pl AtShoot_signatures AtShoot_structures > AtShoot_predictions
$ perl rm_redundancy_meet_plant.pl chromosome_length AtShoot_precursors.fa AtShoot_predictions AtShoot_nr_prediction AtShoot_filter_P_prediction

# JULIE ########################################################

$ cp ../miRDP1.3/* .
$ cp ../a_thaliana_t10.fa .
$ mkdir bowtie-index
#$ bowtie-build -f a_thaliana_t10.fa bowtie-index/TAIR10_genome
$ cp ../bowtie-index/* bowtie-index/
$ cp ../New_M/ncRNA_CDS.gff .
$ cp ../New_M/chromosome_length .
#
$ cp ../Known_M/ath.gff .
$ cp ../Known_M/annotated_miRNA_extended.fa .


# new
$ bowtie -a -v 0 bowtie-index/TAIR10_genome -f high_conf_mature_ath_uniq_collapsed.fa >high_conf_mature_ath_uniq_collapsed.aln
$ perl convert_bowtie_to_blast.pl high_conf_mature_ath_uniq_collapsed.aln high_conf_mature_ath_uniq_collapsed.fa a_thaliana_t10.fa >high_conf_mature_ath_uniq_collapsed.bst
$ perl filter_alignments.pl high_conf_mature_ath_uniq_collapsed.bst -c 15 >high_conf_mature_ath_uniq_collapsed_filter15.bst
$ perl overlap.pl high_conf_mature_ath_uniq_collapsed_filter15.bst ncRNA_CDS.gff -b >id_overlap_ncRNA_CDS
	stdout: high_conf_mature_ath_uniq_collapsed_filter15.bst 154
			ncRNA_CDS.gff 181359
$ perl alignedselected.pl high_conf_mature_ath_uniq_collapsed_filter15.bst -g id_overlap_ncRNA_CDS >high_conf_mature_ath_uniq_collapsed_filter15_ncRNA_CDS.bst
$ perl filter_alignments.pl high_conf_mature_ath_uniq_collapsed_filter15_ncRNA_CDS.bst -b high_conf_mature_ath_uniq_collapsed.fa > high_conf_mature_ath_uniq_collapsed_filtered.fa
$ perl excise_candidate.pl a_thaliana_t10.fa high_conf_mature_ath_uniq_collapsed_filter15_ncRNA_CDS.bst 250 >high_conf_mature_ath_uniq_collapsed_precursors.fa
$ cat high_conf_mature_ath_uniq_collapsed_precursors.fa | RNAfold --noPS > high_conf_mature_ath_uniq_collapsed_structures
$ bowtie-build -f high_conf_mature_ath_uniq_collapsed_precursors.fa bowtie-index/high_conf_mature_ath_uniq_collapsed_precursors
$ bowtie -a -v 0 bowtie-index/high_conf_mature_ath_uniq_collapsed_precursors -f high_conf_mature_ath_uniq_collapsed_filtered.fa > high_conf_mature_ath_uniq_collapsed_precursors.aln
$ perl convert_bowtie_to_blast.pl high_conf_mature_ath_uniq_collapsed_precursors.aln high_conf_mature_ath_uniq_collapsed_filtered.fa high_conf_mature_ath_uniq_collapsed_precursors.fa >high_conf_mature_ath_uniq_collapsed_precursors.bst
$ sort +3 -25 high_conf_mature_ath_uniq_collapsed_precursors.bst >high_conf_mature_ath_uniq_collapsed_signatures
$ perl miRDP.pl high_conf_mature_ath_uniq_collapsed_signatures high_conf_mature_ath_uniq_collapsed_structures > high_conf_mature_ath_uniq_collapsed_predictions
$ perl rm_redundant_meet_plant.pl chromosome_length high_conf_mature_ath_uniq_collapsed_precursors.fa high_conf_mature_ath_uniq_collapsed_predictions high_conf_mature_ath_uniq_collapsed_nr_prediction high_conf_mature_ath_uniq_collapsed_filter_P_prediction


# known
$ bowtie-build -f annotated_miRNA_extended.fa bowtie-index/annotated_miRNA_extended
$ bowtie -a -v 0 bowtie-index/annotated_miRNA_extended -f high_conf_mature_ath_uniq_collapsed.fa >high_conf_mature_ath_uniq_collapsed_extended.aln

$ perl convert_bowtie_to_blast.pl high_conf_mature_ath_uniq_collapsed_extended.aln high_conf_mature_ath_uniq_collapsed.fa annotated_miRNA_extended.fa  > high_conf_mature_ath_uniq_collapsed_extended.bst
$ perl excise_candidate.pl annotated_miRNA_extended.fa high_conf_mature_ath_uniq_collapsed_extended.bst 250 >precursors_250.fa
$ bowtie-build -f precursors_250.fa bowtie-index/precursors_250
$ cat precursors_250.fa|RNAfold --noPS >precursors_250_structure
$ bowtie -a -v 0 bowtie-index/precursors_250 -f high_conf_mature_ath_uniq_collapsed.fa >high_conf_mature_ath_uniq_collapsed_250.aln
$ perl convert_bowtie_to_blast.pl high_conf_mature_ath_uniq_collapsed_250.aln high_conf_mature_ath_uniq_collapsed.fa precursors_250.fa >high_conf_mature_ath_uniq_collapsed_250.bst
$ sort +3 -25 high_conf_mature_ath_uniq_collapsed_250.bst >high_conf_mature_ath_uniq_collapsed_250_signature
$ perl miRDP.pl high_conf_mature_ath_uniq_collapsed_250_signature precursors_250_structure >high_conf_mature_ath_uniq_collapsed_250_prediction
$ cut -f1 high_conf_mature_ath_uniq_collapsed_250_prediction | grep 'seq_' | sort | uniq | wc -l

####################################################################
##
##  UPDATE AUXILIARY FILES
##
####################################################################
Go to miRBase FTP site: http://www.mirbase.org/ftp.shtml
download this file: ath.gff3 (based on miRBase v21, TAIR10, NCBI_Assembly:GCA_000001735.1)

#= to count word between (inclusive) line 1 and 2
sed -n '1,2p' file | wc -w
#= to remove lines
Remove the interval between (inclusive) lines 7 and 9: 
sed '7,9d' filename.txt > remaining.txt


chr
sed -n '2,385162p' a_thaliana_t10.fa | wc -c #= 30812832 - 385161        = 30427671
sed -n '385164,634509p' a_thaliana_t10.fa | wc -c #= 19947635 - 249346   = 19698289
sed -n '634511,931470p' a_thaliana_t10.fa | wc -c #= 23756790 - 296960   = 23459830
sed -n '931472,1166725p' a_thaliana_t10.fa | wc -c #= 18820310 - 235254  = 18585056
sed -n '1166727,1508189p' a_thaliana_t10.fa | wc -c #= 27316965 - 341463 = 26975502
### the chromosome length is exactly the same as tair9

sed '1508191,1514792d' a_thaliana_t10.fa > a_thaliana_t10.fa_remain

#= Go to Arabidopsis website: https://www.arabidopsis.org/download/index.jsp
Genes > TAIR10 genome release (most updated is Araport11 but we stick we v10) > TAIR10 gff3 > TAIR10_GFF3_genes.gff
https://www.arabidopsis.org/download_files/Genes/TAIR10_genome_release/TAIR10_gff3/TAIR10_GFF3_genes.gff
download this file and edit it to obtain two other necessary files

###########################
#= copy lines containing A1 or B3 or C2
grep -E 'A1|B3|C2' filename

grep -E 't3|t2' test.txt

grep -E 'CDS|rRNA|snoRNA|snRNA|tRNA' TAIR10_GFF3_genes.gff > ncRNA_CDS.gff

CDS
gene
rRNA
snoRNA
snRNA
tRNA



